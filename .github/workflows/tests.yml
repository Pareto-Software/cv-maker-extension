name: Testing

on:
  push:
    branches: ['main']
  pull_request:
    branches: ['main']
jobs:
  run-tests:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install npm packages
        run: npm install

      - name: Test code
        run: npm run test

  run-e2e-tests:
    runs-on: ubuntu-latest
    needs: run-tests
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install npm packages
        run: npm install

      - name: Setup environment variables
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          GENERAL_ROLE_GROUP: ${{ secrets.GENERAL_ROLE_GROUP }}
          MANAGER_ROLE_GROUP: ${{ secrets.MANAGER_ROLE_GROUP }}
          NODE_ENV: test
        run: echo "Environment variables configured"

      - name: Build the Application
        run: npm run build


      - name: Run E2E Tests
        run: npm run test:e2e
